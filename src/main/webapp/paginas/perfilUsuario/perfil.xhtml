<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:of="http://omnifaces.org/functions">
    <h:head>
        <title>Facelet Title</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
        <h:outputStylesheet library="css" name="estilos.css"/>    
    </h:head>
    <h:body>

        <ui:composition template="/resources/plantilla/plantilla.xhtml">
            <ui:define name="contenido">
                <f:event type="preRenderView" listener="#{oferta.limpiarDatos()}"/>
                <h1 class="centrar colorAzulOscuro">Perfil de #{usuario.nombre} #{usuario.apellidos}</h1>
                <div class="row col-lg-12 centrar hidden" id="oferta">
                    <!--En este formulario pueden crearse las ofertas para la pagina.
                    La seleccion de categorias se hace llamando a un metodo tipo ArrayList de Subcategorias en el bean de Oferta.
                    Para que el valor de cada objeto del Select sea un objeto de tipo Subcategoria utilizo un convertidor de
                    la libreria omnifaces.
                    Para las fechas utilizo un patron de html5 y un convertidor de jsf, lo que permite que pase al bean como
                    un objeto de tipo Date.-->
                    <h:form id="formulario" class="centrar" enctype="multipart/form-data">
                        <h:outputText class="centrar mensajeOferta colorAzulOscuro" value="#{oferta.mensaje}"/>
                        <h:panelGrid columns="2" border="0" cellspacing="2" class="centrarTabla" >
                            <h:outputLabel value="Imagen de la oferta: "/>
                            <h:inputFile value="#{oferta.imgSubir}"></h:inputFile>
                            <h:outputLabel value="Nombre: "/>
                            <h:inputText value="#{oferta.nombre}" pt:placeholder="Nombre de la Oferta" pt:required="true"/>
                            <h:outputLabel value="DescripciÃ³n: "/>
                            <h:inputText value="#{oferta.descripcion}" pt:placeholder="Descripcion de la Oferta" pt:required="true"/>
                            <h:outputLabel value="Categoria: "/>
                            <h:selectOneMenu value="#{oferta.subcategoria}" converter="omnifaces.SelectItemsConverter">
                                <f:selectItems value="#{subcategoria.subcat}" var="subc" itemValue="#{subc}" itemLabel="#{subc.nombre}"/>
                            </h:selectOneMenu>
                            <h:outputLabel value="Fecha Inicio: "/>
                            <h:inputText value="#{oferta.fechaInicio}" pt:pattern="(0[1-9]|1[0-9]|2[0-9]|3[01]).(0[1-9]|1[012]).[0-9]{4}" pt:placeholder="dd-mm-yyyy" pt:required="true">
                                <f:convertDateTime pattern="dd-mm-yyyy"/>
                            </h:inputText>
                            <h:outputLabel value="Fecha Fin: "/>
                            <h:inputText value="#{oferta.fechaFin}" pt:pattern="(0[1-9]|1[0-9]|2[0-9]|3[01]).(0[1-9]|1[012]).[0-9]{4}" pt:placeholder="dd-mm-yyyy" pt:required="true">
                                <f:convertDateTime pattern="dd-mm-yyyy"/>
                            </h:inputText>
                            <!--<h:commandButton class="centrarTabla" value="Aceptar">
                                <f:ajax execute="@form" listener="{oferta.addOferta()}" render="formulario"/>
                            </h:commandButton>-->
                            <h:commandButton class="btn btn-primary" value="Aceptar" action="#{oferta.addOferta()}"/>
                            <br/>
                        </h:panelGrid>
                    </h:form>
                </div>
                <div class="row col-lg-12 centrar hidden" id="datos">
                    <c:choose>
                        <c:when test="#{usuario.avatar==null}">
                            <h:form enctype="multipart/form-data">
                                <h:outputLabel value="Avatar: "/>
                                <h:inputFile value="#{usuario.imgSubir}" class="centrarTabla"  id="iAvatar"></h:inputFile>
                                <h:commandButton value="Actualizar" action="#{usuario.subirAvatar()}"/>
                            </h:form>
                        </c:when>
                        <c:otherwise>
                            <h:graphicImage alt="foto de perfil" library="imagenes" value="/resources/imagenes/avatares/#{usuario.avatar}" height="120" width="120"/>
                        </c:otherwise>
                    </c:choose>
                    <h:panelGrid columns="2" border="0" cellspacing="2" class="centrarTabla">

                        <h:outputLabel value="Nombre: "/><h:outputText value="#{usuario.nombre}"/>
                        <h:outputLabel value="Apellidos: "/><h:outputText value="#{usuario.apellidos}"/>
                        <h:outputLabel value="Email: "/><h:outputText value="#{usuario.email}"/>
                        <h:outputLabel value="Ciudad de residencia: "/><h:outputText value="#{usuario.ciudad.nombre}"/>
                        <h:outputLabel value="Saldo: "/><h:outputText value="#{usuario.saldo} minutos"/>
                    </h:panelGrid>
                </div>
                <div class="row col-lg-12 centrar hidden" id="promocion">
                    <h:form>
                        <h:outputText value="Introduzca el codigo promocional: "/>
                        <h:inputText value="#{usuario.codigoProm}"/>
                        <h:commandButton value="Enviar" action="#{usuario.comprobarCodigo()}"/>
                    </h:form>
                </div>
                <div class="row col-lg-12 centrar">
                    <button id="botonDatos" class="btn btn-primary">Datos personales</button>
                    <button id="botonOferta" class="btn btn-primary">Crear Oferta</button>
                    <button id="botonPromo" class="btn btn-primary">Introducir codigo promocional</button>
                    <!--<h:button id="botonDatos" class="btn btn-primary" value="Datos Personales"/>
                    <h:button id="botonOferta" class="btn btn-primary" value="Crear Oferta"/>-->
                </div>
                <div class="row col-lg-12 centrar">
                    <br/>
                    <h:form>
                        <h:commandButton  class="btn btn-primary" value="Desconectar" action="#{usuario.logOut()}"/>
                    </h:form>
                </div>
                <script>
                    $("#botonOferta").click(function () {
                        $("#botonOferta").addClass("hidden");
                        if ($("#botonDatos").hasClass("hidden")) {
                            $("#botonDatos").removeClass("hidden");
                        }
                        if ($("#botonPromo").hasClass("hidden")) {
                            $("#botonPromo").removeClass("hidden");
                        }
                        if ($("#oferta").hasClass("hidden")) {
                            if (!$("#datos").hasClass("hidden")) {
                                $("#datos").addClass("hidden");
                            }
                            if (!$("#promocion").hasClass("hidden")) {
                                $("#promocion").addClass("hidden");
                            }
                            $("#oferta").removeClass("hidden");
                        }
                    });
                    $("#botonDatos").click(function () {
                        $("#botonDatos").addClass("hidden");
                        if ($("#botonOferta").hasClass("hidden")) {
                            $("#botonOferta").removeClass("hidden");
                        }
                        if ($("#botonPromo").hasClass("hidden")) {
                            $("#botonPromo").removeClass("hidden");
                        }
                        if ($("#datos").hasClass("hidden")) {
                            if (!$("#oferta").hasClass("hidden")) {
                                $("#oferta").addClass("hidden");
                            }
                            if (!$("#promocion").hasClass("hidden")) {
                                $("#promocion").addClass("hidden");
                            }
                            $("#datos").removeClass("hidden");
                        }
                    });
                    $("#botonPromo").click(function () {
                        $("#botonPromo").addClass("hidden");
                        if ($("#botonOferta").hasClass("hidden")) {
                            $("#botonOferta").removeClass("hidden");
                        }
                        if ($("#botonDatos").hasClass("hidden")) {
                            $("#botonDatos").removeClass("hidden");
                        }
                        if ($("#promocion").hasClass("hidden")) {
                            if (!$("#oferta").hasClass("hidden")) {
                                $("#oferta").addClass("hidden");
                            }
                            if (!$("#datos").hasClass("hidden")) {
                                $("#datos").addClass("hidden");
                            }
                            $("#promocion").removeClass("hidden");
                        }
                    });
                </script>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

